<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BoardingGate Lanzador</title>
    <link rel="icon" href="https://boardinggate.github.io/Tesla/IMG_4157.jpeg" type="image/jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bookmark-item {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5), -4px -4px 8px rgba(255, 255, 255, 0.1);
            position: relative;
        }
        .bookmark-item:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 6px 6px 12px rgba(0, 0, 0, 0.6), -6px -6px 12px rgba(255, 255, 255, 0.15);
        }
        .bookmark-item img {
            image-rendering: crisp-edges;
        }
        .bookmark-name {
            font-weight: bold;
            color: #333; /* Color de texto para modo claro */
            text-align: center;
            margin-top: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        #bookmark-grid {
            display: grid;
            grid-template-columns: repeat(6, minmax(120px, 1fr));
            gap: 15px;
            background-color: transparent;
            border-radius: 0.75rem;
            position: relative;
            width: 100%;
            max-width: 1024px;
            margin: 0 auto;
            transition: all 0.3s ease;
        }
        #bookmark-grid > div {
            height: auto;
            aspect-ratio: 16 / 9;
            transition: all 0.3s ease;
        }
        .bookmark-item {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            background-color: hsla(var(--hue), var(--saturation), var(--lightness), 0.64); /* Color din치mico */
        }
        .bookmark-item img {
            width: 36px;
            height: auto;
            max-width: 40px;
            border-radius: 0.25rem;
        }
        .bookmark-name {
            font-size: clamp(0.85rem, 1.5vw, 1.15rem);
        }
        .small-bookmark img {
            width: 24px;
            max-width: 28px;
        }
        .small-bookmark .bookmark-name {
            font-size: clamp(0.85rem, 1.5vw, 1.15rem);
        }
        @media (max-width: 768px) {
            #bookmark-grid {
                grid-template-columns: repeat(3, minmax(100px, 1fr));
                gap: 10px;
            }
        }
        @media (max-width: 480px) {
            #bookmark-grid {
                grid-template-columns: repeat(2, minmax(80px, 1fr));
                gap: 8px;
            }
        }
        .header-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .header-logo {
            width: 74px;
            height: 4rem;
        }
        .title-container {
            background-color: #000000; /* Fondo negro para el t칤tulo */
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            display: inline-block;
        }
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #000000; /* Fondo general negro */
            margin: 0;
            overflow-x: hidden;
        }
        header {
            margin-bottom: 0.5rem;
        }
        main {
            margin: 0.5rem auto;
            background-color: #4DA7A7; /* Color de fondo solicitado */
            border-radius: 0.75rem;
            padding: 16px;
            min-height: 400px;
            transition: background-color 0.3s ease;
            max-width: 1024px;
            width: 100%;
        }
        body.dark-mode main {
            background-color: #2a5a5a; /* Ajuste para modo oscuro, un tono m치s oscuro de #4DA7A7 */
        }
        body.dark-mode .bookmark-name {
             color: #E5E7EB; /* Color de texto claro para modo oscuro */
        }
        footer {
            margin: 0.5rem auto;
            text-align: center;
            max-width: 1024px;
            width: 100%;
        }
        .header-container { /* Este estilo se repite, el 칰ltimo prevalece */
            background-color: #000000;
            padding: 0.5rem;
        }
        .footer-subtext {
            font-size: 0.75rem;
            color: #9CA3AF;
            margin-top: 0.25rem;
        }
        .footer-link-green {
            color: #90EE90;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .footer-link-green:hover {
            color: #cdc776;
        }
        .footer-line {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .scroll-toggle-button {
            position: fixed;
            width: 91px;
            height: clamp(78.2px, 19.55vw, 175.95px);
            background-color: #1E3A8A;
            border-radius: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: clamp(10px, 2vw, 20px);
            cursor: pointer;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transition: background-color 0.2s ease;
            left: 10px;
            top: 10px;
        }
        .scroll-toggle-button svg {
            width: clamp(24px, 4vw, 32px);
            height: clamp(24px, 4vw, 32px);
        }
        .scroll-toggle-button:hover {
            background-color: #1e40af;
        }
        .top-text-container {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(0.6rem, 1.5vw, 0.75rem);
            color: #38BDF8;
            margin-top: 0.25rem;
            gap: 0.5rem;
            animation: fadeOut 6s forwards;
        }
        .top-text-container span {
            color: #FFFFFF;
            font-size: clamp(0.9rem, 2vw, 1.2rem);
        }
        @keyframes fadeOut {
            0% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }
        .arrow-button {
            width: clamp(36px, 6vw, 48px);
            height: clamp(36px, 6vw, 48px);
            background-color: #1E3A8A;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            transition: background-color 0.2s ease;
        }
        .arrow-button:hover {
            background-color: #1e40af;
        }
        .counter-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin-top: 1rem;
            text-align: center;
        }
        .favicon-red {
            filter: hue-rotate(0deg) saturate(200%) brightness(80%);
        }
        .favicon-blue {
            filter: hue-rotate(200deg) saturate(150%) brightness(90%);
        }
        .notices-container {
            width: 100%;
            max-width: 1024px;
            margin: 0 auto;
            padding: 0.5rem;
            border: none;
            border-radius: 0.5rem;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            height: 3rem;
        }
        .notice-wrapper {
            padding: 0.5rem;
            height: 1.5rem;
            flex-grow: 1;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .notice {
            color: #00ff00; /* Color verde para los avisos */
            font-weight: bold;
            white-space: nowrap;
            text-align: center;
            opacity: 0;
            animation: fadeInOut 14s infinite;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; }
        }
        .notice-off-icon {
            width: 30px;
            height: 30px;
            margin-left: 45px;
            margin-right: 10px;
            align-self: center;
            cursor: pointer;
            opacity: 0.6;
        }
        .megaphone-icon-end {
            width: auto;
            height: clamp(2rem, 5vw, 3rem);
            margin-left: 0;
            margin-right: 45px;
            transform: scaleX(-1);
            opacity: 0.6;
        }
        .toggle-sign {
            position: fixed;
            width: 91px;
            height: 54px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
            text-align: center;
            cursor: pointer;
            z-index: 1000;
            transition: background-color 0.2s ease;
            left: 10px;
            /* top position is set dynamically by JS */
        }
        .toggle-sign .sign {
            font-size: 1.5rem;
            margin-right: 2px;
        }
        .toggle-sign:hover {
            background-color: #666666;
        }
        body.dark-mode .toggle-sign:hover {
            background-color: #4b5563;
        }
        body.dark-mode .toggle-sign.range-toggle[data-state="visible"]:hover {
            background-color: #1f9e4e;
        }
        body.dark-mode .toggle-sign.range-toggle[data-state="hidden"]:hover {
            background-color: #6b7280;
        }
        .toggle-sign img {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }
        #dark-mode-toggle img {
            width: 48px;
            height: 48px;
        }
        #on-off-toggle img {
            width: 56px;
            height: 56px;
        }
        #reminder-button {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            background-color: #5DA8D6; /* Color base del bot칩n Recordatorios */
        }
        #reminder-button img {
            width: 48px;
            height: 48px;
            object-fit: contain;
        }
        #reminder-button .reminder-count {
            position: absolute;
            top: 4px;
            left: 4px;
            font-size: 0.65rem;
            color: #000000;
            font-weight: bold;
            background-color: white; /* Fondo para que sea visible */
            padding: 1px 3px;
            border-radius: 50%;
        }
        #zoom-button {
             background-color: #f97316; /* Color base bot칩n Zoom */
        }
         #zoom-button.zoomed {
             background-color: #ea580c; /* Color bot칩n Zoom activado */
        }
        #reload-button {
             background-color: #0891b2; /* Color base bot칩n Recargar */
        }
        #weather-button {
             background-color: #d97706; /* Color base bot칩n Ventusky */
        }

        .hidden {
            display: none;
        }
        .footer-hidden {
            display: none;
        }
        .version-text {
            font-size: 0.75rem;
            color: #38BDF8;
            font-weight: normal;
        }
        #dark-mode-toggle {
            background-color: #F0F0F0; /* Color modo claro */
        }
        #on-off-toggle {
            background-color: #E0E0E0; /* Color modo claro */
            color: #333; /* Texto oscuro para contraste */
        }
        .range-toggle {
            color: #FFFFFF; /* Texto blanco por defecto para los botones de rango */
        }
        /* --- Modos Oscuro y M칤nimo --- */
        body.dark-mode .bookmark-item {
            filter: brightness(80%); /* Ajuste para que no sea tan oscuro */
             box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.7), -4px -4px 8px rgba(255, 255, 255, 0.05);
        }
        body.dark-mode .bookmark-item:hover {
            filter: brightness(95%);
             box-shadow: 6px 6px 12px rgba(0, 0, 0, 0.8), -6px -6px 12px rgba(255, 255, 255, 0.08);
        }
        body.dark-mode .bg-gray-50.border.border-dashed.border-gray-200.rounded-lg {
            filter: brightness(60%);
        }
        body.dark-mode .scroll-toggle-button {
            background-color: #1e293b;
        }
        body.dark-mode .scroll-toggle-button:hover {
            background-color: #334155;
        }
        body.dark-mode .toggle-sign { /* Estilo general para modo oscuro */
            background-color: #374151;
            color: #E5E7EB; /* Texto claro */
        }
        body.dark-mode #on-off-toggle {
            background-color: #4B5563; /* Gris oscuro */
            color: #E5E7EB;
        }
        body.dark-mode #dark-mode-toggle {
            background-color: #4B5563; /* Gris oscuro */
        }
        body.dark-mode #reload-button {
            background-color: #155e75; /* Cyan oscuro */
        }
        body.dark-mode #weather-button {
            background-color: #92400e; /* 츼mbar oscuro */
        }
         body.dark-mode #reminder-button {
            background-color: #0369a1; /* Azul cielo oscuro */
        }
        body.dark-mode #zoom-button:not(.zoomed) {
            background-color: #b45309; /* Naranja oscuro */
        }
        body.dark-mode #zoom-button.zoomed {
            background-color: #7c2d12; /* Naranja m치s oscuro */
        }

        .minimal-mode {
            background-color: #000000;
        }
        .minimal-mode header, /* Ocultar header en modo m칤nimo */
        .minimal-mode main,
        .minimal-mode .notices-container,
        .minimal-mode footer,
        .minimal-mode .top-text-container,
        .minimal-mode .scroll-toggle-button,
        .minimal-mode .toggle-sign:not(#on-off-toggle),
        .minimal-mode #reminder-notifications {
            display: none !important;
        }
        .minimal-mode #on-off-toggle {
            background-color: #D1D5DB;
            opacity: 0.3;
            top: 10px !important; /* Forzar posici칩n */
            left: 10px;
        }
        .minimal-mode #on-off-toggle:hover {
             opacity: 0.8; /* M치s visible al pasar el rat칩n */
        }
        .minimal-mode-message {
            color: #9CA3AF;
            font-size: 0.75rem;
            position: fixed;
            top: 70px;
            left: 10px;
            z-index: 1000;
        }
         /* --- Modal y Notificaciones de Recordatorios --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1999;
            display: none; /* Oculto por defecto */
        }
        .reminder-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #F3F4F6;
            color: #111827; /* Texto oscuro para modo claro */
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            max-width: 400px;
            width: 90%;
            display: none; /* Oculto por defecto */
        }
        body.dark-mode .reminder-modal {
             background-color: #374151; /* Fondo oscuro para modal */
             color: #E5E7EB; /* Texto claro */
        }
        body.dark-mode .reminder-modal input,
        body.dark-mode .reminder-modal textarea {
            background-color: #4B5563;
            border-color: #6B7280;
            color: #E5E7EB;
        }
        body.dark-mode .reminder-modal button[type="button"] {
            background-color: #6B7280;
            color: #E5E7EB;
        }

        .reminder-modal h2 {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        .reminder-modal label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .reminder-modal input,
        .reminder-modal textarea {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.25rem;
            background-color: #FFFFFF; /* Fondo blanco inputs */
            color: #111827; /* Texto oscuro inputs */
        }
        .reminder-modal .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        .reminder-modal button {
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            border: none; /* Quitar borde por defecto */
        }
        .reminder-modal button[type="submit"] {
            background-color: #2563EB; /* Azul */
            color: #FFFFFF;
        }
        .reminder-modal button[type="button"] {
            background-color: #D1D5DB; /* Gris claro */
            color: #111827; /* Texto oscuro */
        }
        #reminder-notifications {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1500;
            max-width: 300px;
            width: 90%;
        }
        .reminder-notification {
            background-color: #FFFF99; /* Amarillo claro */
            color: #333; /* Texto oscuro para contraste */
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
         body.dark-mode .reminder-notification {
             background-color: #6b7280; /* Gris oscuro para notificaciones */
             color: #E5E7EB; /* Texto claro */
         }
         body.dark-mode .reminder-notification p {
             color: #90EE90; /* Texto verde claro en modo oscuro */
         }

        .reminder-notification p {
            margin: 0;
            font-size: 1.25rem;
            color: #0000FF; /* Texto azul en modo claro */
            word-break: break-word; /* Evitar desbordamiento */
        }
        .reminder-notification .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }
        .reminder-notification button {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.9rem;
            border: none;
        }
        .reminder-notification button.cancel {
            background-color: #EF4444; /* Rojo */
            color: #FFFFFF;
        }
        .reminder-notification button.modify {
            background-color: #10B981; /* Verde */
            color: #FFFFFF;
        }
        .reminder-notification button.postpone {
            background-color: #F59E0B; /* 츼mbar */
            color: #FFFFFF;
        }
    </style>
</head>
<body class="flex flex-col items-center p-6"> <div class="top-text-container">
        <div class="arrow-button" id="back-button" title="Ir atr치s">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </div>
        <span>[ Web anterior o posterior arrastre hacia los bordes ]</span>
        <div class="arrow-button" id="forward-button" title="Ir adelante">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </div>
    </div>

    <main>
        <div id="bookmark-grid">
            </div>
    </main>

    <div class="notices-container">
        <img src="https://boardinggate.github.io/Tesla/IMG_4194.jpeg" alt="Toggle Avisos" class="notice-off-icon" id="notice-toggle-icon" title="Activar/Desactivar Avisos">
        <div class="notice-wrapper">
            <span class="notice" id="current-notice"></span>
        </div>
        <img src="./avisos.png" alt="Meg치fono Fin" class="megaphone-icon-end">
    </div>

    <footer>
        <div class="footer-content mt-8 text-center">
            <div class="header-container">
                <img src="https://boardinggate.github.io/Tesla/IMG_4157.jpeg" alt="Logo de Tesla" class="header-logo">
                <div class="title-container">
                    <h1 class="text-2xl font-bold text-sky-400 inline">
                        BoardingGate <span class="text-base text-sky-400">Lanzador</span>
                        <span id="version" class="version-text"></span>
                    </h1>
                </div>
            </div>
            <div class="footer-line">
                <a href="https://x.com/boardinggate?s=21" class="footer-link-green" target="_blank" rel="noopener noreferrer">@BoardingGate</a>
                <span class="text-green-200" style="font-size: 1.5rem;">游뱋</span>
                <a href="https://x.com/boardinggate/status/1857325553742721116?s=46" class="footer-link-green" target="_blank" rel="noopener noreferrer">Ahorremos un dinero con mis REFERIDOS</a>
            </div>
            <p class="footer-subtext">La inteligencia tiene ciertas limitaciones. La locura, casi ninguna 游삤 游</p>
            <div class="counter-container text-center">
                <div id="sfcg896pbr68y2dejczgbn1ys664xjxdf2d"></div>
                <script type="text/javascript" src="https://counter4.optistats.ovh/private/counter.js?c=g896pbr68y2dejczgbn1ys664xjxdf2d&down=async" async></script>
            </div>
        </div>
    </footer>

    <div id="scroll-toggle" class="scroll-toggle-button" title="Ir al inicio o fin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
    </div>

    <div id="reminder-notifications"></div>

    <div id="modal-overlay" class="modal-overlay"></div>
    <div id="reminder-modal" class="reminder-modal">
        <h2 id="reminder-modal-title">A침adir Recordatorio</h2>
        <form id="reminder-form">
            <input type="hidden" id="reminder-id">
            <div>
                <label for="reminder-text">Texto:</label>
                <textarea id="reminder-text" name="reminder-text" rows="3" required></textarea>
            </div>
            <div>
                <label for="reminder-time">Hora (HH:MM):</label>
                <input type="time" id="reminder-time" name="reminder-time" required>
            </div>
            <div class="button-group">
                <button type="button" id="cancel-reminder">Cancelar</button>
                <button type="submit" id="save-reminder">Guardar</button>
            </div>
        </form>
    </div>

     <div id="minimal-mode-message" class="minimal-mode-message hidden">Modo M칤nimo Activo</div>


    <script>
        const bookmarks = [
            { name: "YouTube", url: "https://www.youtube.com" },
            { name: "Google", url: "https://www.google.com" },
            { name: "GDrive", url: "https://drive.google.com", favicon: "./IMG_4172.png" },
            { name: "GMail", url: "https://mail.google.com/mail/mu/mp/603/#tl/Recibidos", favicon: "./IMG_4171.png"},
            { name: "Google Fotos", url: "https://photos.google.com" },
            { name: "iCloud", url: "https://www.icloud.com/", favicon: "https://www.google.com/s2/favicons?domain=icloud.com&sz=64" },
            { name: "ABRP", url: "https://abetterrouteplanner.com" },
            { name: "ElectroMaps", url: "https://map.electromaps.com/es/", favicon: "https://www.google.com/s2/favicons?domain=electromaps.com&sz=64" },
            { name: "REVE PdR Espa침a", url: "https://www.mapareve.es/mapa-puntos-recarga", favicon: "https://www.google.com/s2/favicons?domain=mapareve.es&sz=64" },
            { name: "PdR,s", url: "https://www.google.com/maps/search/puntos+recarga+veh%C3%ADculos+el%C3%A9ctricos", favicon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M12 18h8v2h-8v-2z'/><path d='M12 14h8v2h-8v-2z'/><path d='M12 10h8v2h-8v-2z'/><path d='M12 6h8v2h-8V6z'/><path d='M4 18h4v-2H4v2zM4 14h4v-2H4v2zM4 10h4v-2H4v2zM4 6h4V4H4v2z'/></svg>" },
            { name: "Google Maps", url: "https://maps.google.com" },
            { name: "", url: "https://www.ventusky.com/?p=40.2;-4.7;5&l=rain-3h" }, // Enlace sin nombre, usar치 favicon
            { name: "TESSIE", url: "https://dash.tessie.com/signin", favicon: "https://www.google.com/s2/favicons?domain=tessie.com&sz=64" },
            { name: "Mis Updates", url: "https://dash.tessie.com/software", favicon: "https://cdn-icons-png.flaticon.com/512/148/148767.png" },
            { name: "Olas Updates", url: "https://es.stats.tessie.com/", favicon: "https://cdn-icons-png.flaticon.com/512/5815/5815902.png" },
            { name: "NotaTeslaApp", url: "https://www.notateslaapp.com/software-updates/" },
            { name: "ENHAUTO", url: "https://www.enhauto.com" },
            { name: "MAREAS", url: "https://www.meteogalicia.gal/web/predicion/mareas-e-luas" },
            { name: "ELECTROVERSE", url: "https://electroverse.com/es/map", favicon: "https://www.google.com/s2/favicons?domain=electroverse.com&sz=64" },
            { name: "ACCIONA", url: "https://www.google.com/maps/search/recarga+Acciona", favicon: "https://www.google.com/s2/favicons?domain=acciona.com&sz=64" },
            { name: "IBERDROLA", url: "https://www.google.com/maps/search/recarga+IBERDROLA", favicon: "https://www.google.com/s2/favicons?domain=iberdrola.com&sz=64" },
            { name: "WAYLET Repsol", url: "https://www.google.com/maps/search/recarga+REPSOL+Waylet", favicon: "https://www.google.com/s2/favicons?domain=repsol.com&sz=64" },
            { name: "ENDESA xWay", url: "https://www.google.com/maps/search/recarga+ENDESA+XWAY", favicon: "https://www.google.com/s2/favicons?domain=endesa.com&sz=64" },
            { name: "ZUNDER", url: "https://www.google.com/maps/search/recarga+ZUNDER", favicon: "https://www.google.com/s2/favicons?domain=zunder.com&sz=64" },
            { name: "IONITY", url: "https://www.google.com/maps/search/recarga+IONITY", favicon: "https://www.google.com/s2/favicons?domain=ionity.eu&sz=64" },
            { name: "WENEA", url: "https://www.google.com/maps/search/recarga+WENEA", favicon: "https://www.google.com/s2/favicons?domain=wenea.com&sz=64" },
            { name: "T.ENERGIES", url: "https://www.google.com/maps/search/recarga+TOTAL+ENERGIES", favicon: "https://www.google.com/s2/favicons?domain=totalenergies.com&sz=64" },
            { name: "GALP", url: "https://www.google.com/maps/search/recarga+GALP", favicon: "https://www.google.com/s2/favicons?domain=galp.com&sz=64" },
            { name: "MIIO", url: "https://miio.com", favicon: "https://www.google.com/s2/favicons?domain=miio.com&sz=64" },
            { name: "EVDC", url: "https://evdc.network", favicon: "https://www.google.com/s2/favicons?domain=evdc.network&sz=64" },
            { name: "GROK", url: "https://grok.com/?referrer=website" },
            { name: "CHATGPT", url: "https://chat.openai.com" },
            { name: "CLAUDE", url: "https://claude.ai/new" },
            { name: "GEMINI", url: "https://gemini.google.com" },
            { name: "NOTEBOOKLM", url: "https://notebooklm.google.com" },
            { name: "Bater칤a", url: "https://docs.google.com/spreadsheets/d/1bLZmgVGTBqg2bS2E45JpORjs9eK2nb05AWXYLLDY-RI/edit?gid=1398548891#gid=1398548891", favicon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='12' cy='12' r='10'/><polyline points='12 6 12 12 16 14'/></svg>" },
            { name: "TeslaParaTodos", url: "https://teslaparatodos.com/cine/" },
            { name: "BetterTheater", url: "https://abettertheater.com", favicon: "https://www.google.com/s2/favicons?domain=abettertheater.com&sz=64" },
            { name: "Filmin", url: "https://www.filmin.es/catalogo/peliculas" },
            { name: "Octopus", url: "https://octopus.energy/dashboard" },
            { name: "App MCE", url: "https://www.oscarabilleira.com/app-mi-coche-electrico/#ayuda" },
            { name: "Patr칩n Luz", url: "https://docs.google.com/spreadsheets/d/1R7UUZ9i4BAYWAGAX6PQT1WGd12GEZ4Ja/edit?usp=sharing&ouid=108345701896498198132&rtpof=true&sd=true" },
            { name: "TradingView", url: "https://es.tradingview.com/chart/t5g9UFG0/" },
            { name: "Inicio Tesla" }, // Bot칩n especial sin URL expl칤cita
            { name: "Twitter", url: "https://x.com" },
            { name: "Maesal Detailer", url: "https://www.maesaldetailer.es/" },
            { name: "Superchargers", url: "https://www.tesla.com/es_es/findus?bounds=45.41107111786193%2C19.27853056943938%2C29.703668286784747%2C-16.64676239931062" },
            { name: "TESLA web", url: "https://www.tesla.com/es_es" },
            { name: "Manual M3", url: "https://www.tesla.com/ownersmanual/model3/es_es/" },
            { name: "de Servicio", url: "https://service.tesla.com/docs/Model3/ServiceManual/2024/es-es/" },
            { name: "de Despiece", url: "https://epc.tesla.com/es-MX/catalogs/e0e07c3d-272f-4d06-b8b6-9e92f857e5f3" },
            { name: "de Usted Mismo", url: "https://www.tesla.com/es_es/support/do-it-yourself-guides" },
            { name: "de Filtro Cabina", url: "https://service.tesla.com/docs/Public/diy/model3/es_es/GUID-DB0A1E3C-926E-498C-A2FD-A27B8421A471.html" },
            { name: "de M칩vil remoto", url: "https://service.tesla.com/docs/Public/diy/model3/es_es/GUID-53651B16-A2E3-4118-933E-B5F41C74D433.html" },
            { name: "Waze (consultas)", url: "https://www.waze.com/es/live-map/", favicon: "https://www.google.com/s2/favicons?domain=waze.com&sz=64" },
            { name: "AMAZON", url: "https://www.amazon.es" },
            { name: "BIP&DRIVE", url: "https://areaprivada.bipdrive.com/login" },
            { name: "ITV Cita", url: "https://www.sycitv.com/es/cita-previa-particulares/", favicon: "https://boardinggate.github.io/Tesla/itv.png" },
            null, null, // Espacios vac칤os
            { name: "Jaime Odena", url: "https://www.youtube.com/@JOdena", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Eduardo Arcos", url: "https://www.youtube.com/@earcos", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "AutoIngenium", url: "https://www.youtube.com/@AutoIngenium", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Gallego en Munich", url: "https://www.youtube.com/@ungallegoenmunich", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Electromiaumiau", url: "https://www.youtube.com/@electromiaumiau", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Manuel Martos", url: "https://www.youtube.com/@Manuel_Martos", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Todos Electricos", url: "https://www.youtube.com/@TodosElectricos", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Juan Vidal Haces", url: "https://www.youtube.com/@JuanVidalHaces", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Ruedana", url: "https://www.youtube.com/@ruedana", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "STR-600", url: "https://www.youtube.com/@STR-600", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Juanjo T. Aventuras", url: "https://www.youtube.com/@juanjoteslaventuras", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Carlos Cuezva", url: "https://www.youtube.com/@CarlosCuezva", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Javi Manzanoo", url: "https://www.youtube.com/@javimanzanoo", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Crifedi", url: "https://www.youtube.com/@Crifedi", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Tescno Tesla", url: "https://www.youtube.com/@TecnoTesla", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Full Electric Mex", url: "https://www.youtube.com/@FullElectricMexico", favicon: "https://www.youtube.com/favicon.ico" },
            null, // Espacio vac칤o
            null, // Espacio vac칤o
            { name: "La iA Jon", url: "https://www.youtube.com/@la_inteligencia_artificial", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "JF Ccalero", url: "https://www.youtube.com/@jfcalero", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Visual Politik", url: "https://www.youtube.com/@VisualPolitik", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Fabian Barrio", url: "https://www.youtube.com/@fabiancbarrio", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Loquetudigas", url: "https://www.youtube.com/@Loquetudigas", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "David Antunes", url: "https://www.youtube.com/@davidantunesmusic", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "TheWildProject", url: "https://www.youtube.com/@TheWildProject", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "Estas Tonne", url: "https://www.youtube.com/@Estastonne", favicon: "https://www.youtube.com/favicon.ico" },
            { name: "BBC6 Music", url: "https://www.youtube.com/@BBC6Music", favicon: "https://www.youtube.com/favicon.ico" },
            null, null // Espacios vac칤os al final si es necesario
        ];
        const TOTAL_CELLS = 96; // Aseg칰rate que coincida con el n칰mero total de celdas deseadas (16 filas * 6 columnas)
        const COLS = 6;
        const grid = document.getElementById('bookmark-grid');
        let isDarkMode = false;
        let isMinimalMode = false;
        let pressStartTime = null; // Para detectar pulsaci칩n larga en on-off
        let reminderPressStartTime = null; // Para pulsaci칩n larga en reminder
        let isActive = true; // Para los avisos
        let isFooterVisible = true;
        let activeReminders = []; // Array para almacenar timeouts de recordatorios
        let reminderCheckInterval = null; // Intervalo para comprobar recordatorios
        const versionNumber = "v2.5"; // Define el n칰mero de versi칩n aqu칤

        const notices = [
            "춰Explora los nuevos enlaces de carga el칠ctrica!",
            "Personaliza tu experiencia con el modo oscuro",
            "A침ade recordatorios para no olvidar nada",
            "Usa el zoom para una mejor visualizaci칩n",
            "Visita nuestros enlaces de referidos y ahorra"
        ];
        let currentNoticeIndex = 0;
        let noticeIntervalId = null;

        // --- Funciones de Utilidad ---
        function getFaviconUrl(bookmark) {
            if (bookmark.favicon) {
                return bookmark.favicon;
            }
            if (bookmark.url) {
                // Favicon por defecto de Google si no hay uno espec칤fico y hay URL
                return `https://www.google.com/s2/favicons?domain=${new URL(bookmark.url).hostname}&sz=64`;
            }
            // Icono gen칠rico si no hay URL ni favicon espec칤fico
            return 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="gray" width="24px" height="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>';
        }

        // --- Funciones Principales ---
        function createBookmarkElement(bookmark, index) {
            const div = document.createElement('div');
            div.style.setProperty('--hue', (index * 15) % 360);
            div.style.setProperty('--saturation', '70%');
            div.style.setProperty('--lightness', '80%');

            if (!bookmark) {
                div.className = 'bg-gray-50 border border-dashed border-gray-200 rounded-lg'; // Placeholder visual
                return div;
            }

            div.className = 'bookmark-item p-2 flex flex-col items-center justify-center cursor-pointer rounded-lg relative';
            div.dataset.url = bookmark.url || '#'; // A침adir # si no hay URL
            div.dataset.name = bookmark.name;
            div.title = bookmark.name || 'Enlace'; // Tooltip

            const img = document.createElement('img');
            img.src = getFaviconUrl(bookmark);
            img.alt = bookmark.name || 'Favicon';
            img.className = 'mb-1'; // Margen inferior
            img.onerror = function() {
                // Fallback a un icono gen칠rico si el favicon falla
                this.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="gray" width="24px" height="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>';
            };

            const nameSpan = document.createElement('span');
            nameSpan.className = 'bookmark-name text-xs md:text-sm'; // Tama침o de texto responsivo
            nameSpan.textContent = bookmark.name || ' '; // Espacio si no hay nombre para mantener altura

            // L칩gica especial para "Inicio Tesla"
            if (bookmark.name === "Inicio Tesla") {
                div.addEventListener('click', () => {
                    window.history.go(-(window.history.length - 1));
                    // O alternativamente: window.location.href = '/'; si es una p치gina espec칤fica
                });
            } else if (bookmark.url) {
                 div.addEventListener('click', () => {
                     if (bookmark.url !== '#') { // Solo abrir si hay URL real
                         window.open(bookmark.url, '_blank');
                     }
                 });
            } else {
                 div.classList.add("cursor-default"); // No hacer nada si no hay URL
                 div.style.opacity = "0.5"; // Indicar que no es interactivo
            }

            div.appendChild(img);
            div.appendChild(nameSpan);
            return div;
        }

        function populateGrid() {
            grid.innerHTML = ''; // Limpiar grid antes de repoblar
            for (let i = 0; i < TOTAL_CELLS; i++) {
                const bookmark = bookmarks[i] || null; // Usar null si el 칤ndice est치 fuera de bounds
                const element = createBookmarkElement(bookmark, i);
                grid.appendChild(element);
            }
            applyZoom(); // Reaplicar zoom si est치 activo
            applyDarkModeStyles(); // Reaplicar estilos dark mode
            applyRangeToggleVisibility(); // Reaplicar visibilidad de rangos
        }

         function createControlButtons() {
            const controlContainer = document.body; // A침adir botones directamente al body
            const existingControls = document.querySelectorAll('.toggle-sign, .scroll-toggle-button');
            existingControls.forEach(el => el.remove()); // Limpiar botones existentes

            const buttonSpacing = 64; // Espacio vertical entre botones (54px alto + 10px margen)
            let currentTop = 10; // Posici칩n inicial 'top' para el primer bot칩n (scroll-toggle)

            // 1. Bot칩n Scroll (siempre visible excepto modo m칤nimo)
            const scrollToggle = document.getElementById('scroll-toggle') || document.createElement('div'); // Reutilizar o crear
            scrollToggle.id = 'scroll-toggle';
            scrollToggle.className = 'scroll-toggle-button';
            scrollToggle.title = "Ir al inicio o fin";
            scrollToggle.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>`;
            scrollToggle.style.top = `${currentTop}px`;
            scrollToggle.addEventListener('click', toggleScroll);
            controlContainer.appendChild(scrollToggle);
            currentTop += scrollToggle.offsetHeight + 10; // Actualizar top para el siguiente bot칩n

            // 2. Botones de control (ON/OFF, Dark Mode, Reload, Weather, Reminder, Zoom)
             const controls = [
                { id: 'on-off-toggle', title: 'Modo M칤nimo', icon: './IMG_4196_OFF.png', state: isMinimalMode ? 'hidden' : 'visible', onClick: handleOnOffPress, onRelease: handleOnOffRelease, onLongPress: toggleMinimalMode },
                { id: 'dark-mode-toggle', title: 'Modo Oscuro', icon: './dark-mode-icon.png', onClick: toggleDarkMode }, // Usar icono dedicado
                { id: 'reload-button', title: 'Recargar', icon: './refresh-icon.png', onClick: () => window.location.reload() },
                { id: 'weather-button', title: 'Ventusky', icon: './cloud-icon.png', onClick: () => window.open('https://www.ventusky.com/?p=40.2;-4.7;5&l=rain-3h', '_blank') },
                // --- ORDEN CAMBIADO ---
                { id: 'reminder-button', title: 'Recordatorios (Hold: A침adir)', icon: './reminder-icon.png', onClick: handleReminderPress, onRelease: handleReminderRelease, onLongPress: openAddReminderModal },
                { id: 'zoom-button', title: 'Zoom', icon: './zoom-icon.png', state: 'normal', onClick: toggleZoom }
            ];

            controls.forEach(control => {
                const button = document.createElement('div');
                button.id = control.id;
                button.className = 'toggle-sign';
                button.title = control.title;
                button.style.top = `${currentTop}px`;

                const img = document.createElement('img');
                img.src = control.icon;
                img.alt = control.title;

                button.appendChild(img);

                // A침adir contador para recordatorios
                if (control.id === 'reminder-button') {
                    const countSpan = document.createElement('span');
                    countSpan.className = 'reminder-count hidden'; // Oculto por defecto
                    button.appendChild(countSpan);
                    // A침adir eventos de pulsaci칩n
                     button.addEventListener('mousedown', control.onClick);
                     button.addEventListener('mouseup', control.onRelease);
                     button.addEventListener('mouseleave', control.onRelease); // Cancelar si el rat칩n sale
                     button.addEventListener('touchstart', control.onClick);
                     button.addEventListener('touchend', control.onRelease);
                } else if (control.id === 'on-off-toggle') {
                     button.addEventListener('mousedown', control.onClick);
                     button.addEventListener('mouseup', control.onRelease);
                     button.addEventListener('mouseleave', control.onRelease);
                     button.addEventListener('touchstart', control.onClick);
                     button.addEventListener('touchend', control.onRelease);
                     button.dataset.state = control.state; // Para modo m칤nimo
                } else {
                    button.addEventListener('click', control.onClick);
                }


                if (control.state) {
                    button.dataset.state = control.state; // Para zoom y on-off
                }
                 // Aplicar clase 'zoomed' si corresponde
                 if (control.id === 'zoom-button' && localStorage.getItem('zoomState') === 'zoomed') {
                     button.classList.add('zoomed');
                     button.dataset.state = 'zoomed';
                 }


                controlContainer.appendChild(button);
                currentTop += buttonSpacing; // Incrementar top para el siguiente bot칩n
            });

             updateReminderCount(); // Actualizar contador inicial
             applyMinimalMode(); // Aplicar modo m칤nimo si est치 activo
             applyDarkModeStyles(); // Asegurarse de que los estilos de modo oscuro se apliquen
        }

        // --- Funciones de Eventos y L칩gica ---
        function handleOnOffPress(event) {
             event.preventDefault(); // Prevenir comportamiento por defecto (ej: selecci칩n de texto)
             pressStartTime = Date.now();
         }

         function handleOnOffRelease() {
             if (pressStartTime) {
                 const pressDuration = Date.now() - pressStartTime;
                 if (pressDuration < 500) { // Menos de 500ms es un click normal
                     toggleFooter();
                 }
                 // La pulsaci칩n larga se maneja en el timeout de handleOnOffPress, pero la quitamos
                 // y usamos la funci칩n onLongPress separada que se llama desde createControlButtons
                 pressStartTime = null;
             }
         }

         function handleReminderPress(event) {
            event.preventDefault();
            reminderPressStartTime = Date.now();
         }

         function handleReminderRelease() {
            if (reminderPressStartTime) {
                const pressDuration = Date.now() - reminderPressStartTime;
                if (pressDuration < 500) { // Click corto: muestra/oculta notificaciones
                    toggleReminderNotificationsVisibility();
                }
                // La pulsaci칩n larga (>= 500ms) se maneja con onLongPress (openAddReminderModal)
                reminderPressStartTime = null;
            }
         }


        function toggleScroll() {
            const currentScroll = window.scrollY || document.documentElement.scrollTop;
            const maxScroll = document.documentElement.scrollHeight - window.innerHeight;

            if (currentScroll < maxScroll / 2) {
                // Si est치 m치s cerca de arriba, ir abajo
                window.scrollTo({ top: maxScroll, behavior: 'smooth' });
            } else {
                // Si est치 m치s cerca de abajo, ir arriba
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            applyDarkModeStyles();
            saveSettings();
        }

        function applyDarkModeStyles() {
            const darkModeButton = document.getElementById('dark-mode-toggle');
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                if (darkModeButton) {
                     darkModeButton.querySelector('img').src = './dark-mode-icon-on.png'; // Icono ON
                     darkModeButton.title = 'Desactivar Modo Oscuro';
                }
                 // Ajustar color de fondo principal para modo oscuro
                 document.querySelector('main').style.backgroundColor = '#2a5a5a'; // Tono oscuro de #4DA7A7
            } else {
                document.body.classList.remove('dark-mode');
                if (darkModeButton) {
                    darkModeButton.querySelector('img').src = './dark-mode-icon.png'; // Icono OFF (original)
                    darkModeButton.title = 'Activar Modo Oscuro';
                }
                 // Restaurar color de fondo principal para modo claro
                 document.querySelector('main').style.backgroundColor = '#4DA7A7';
            }
             // Actualizar estilos de botones espec칤ficos que cambian con dark mode
             const onOffToggle = document.getElementById('on-off-toggle');
             const reminderButton = document.getElementById('reminder-button');
             const zoomButton = document.getElementById('zoom-button');
             const reloadButton = document.getElementById('reload-button');
             const weatherButton = document.getElementById('weather-button');

             // Re-aplicar clases o estilos seg칰n el modo (ya definidos en CSS con body.dark-mode)
             // No es necesario cambiar estilos inline aqu칤 si el CSS est치 bien definido.
        }


         function toggleMinimalMode() {
             isMinimalMode = !isMinimalMode;
             applyMinimalMode();
             saveSettings();
         }

        function applyMinimalMode() {
            const onOffButton = document.getElementById('on-off-toggle');
            const minimalMessage = document.getElementById('minimal-mode-message');
            if (isMinimalMode) {
                document.body.classList.add('minimal-mode');
                if (onOffButton) {
                    onOffButton.querySelector('img').src = './IMG_4196_ON.png'; // Icono ON
                    onOffButton.title = 'Desactivar Modo M칤nimo';
                    onOffButton.dataset.state = 'hidden';
                }
                if(minimalMessage) minimalMessage.classList.remove('hidden'); // Mostrar mensaje
                 // Ocultar otros botones excepto on-off
                 document.querySelectorAll('.toggle-sign:not(#on-off-toggle), .scroll-toggle-button').forEach(btn => btn.classList.add('hidden'));
            } else {
                document.body.classList.remove('minimal-mode');
                 if (onOffButton) {
                    onOffButton.querySelector('img').src = './IMG_4196_OFF.png'; // Icono OFF
                    onOffButton.title = 'Activar Modo M칤nimo (Hold)';
                    onOffButton.dataset.state = 'visible';
                }
                 if(minimalMessage) minimalMessage.classList.add('hidden'); // Ocultar mensaje
                 // Mostrar otros botones
                 createControlButtons(); // Regenerar botones para asegurar posiciones correctas
                 applyRangeToggleVisibility(); // Reaplicar visibilidad de rangos
            }
            // No es necesario guardar aqu칤, se guarda en toggleMinimalMode
        }

        function toggleZoom() {
             const zoomButton = document.getElementById('zoom-button');
             const currentState = zoomButton.dataset.state || 'normal';

             if (currentState === 'normal') {
                 zoomButton.dataset.state = 'zoomed';
                 zoomButton.classList.add('zoomed'); // Para CSS espec칤fico del estado zoom
                 zoomButton.title = "Quitar Zoom";
             } else {
                 zoomButton.dataset.state = 'normal';
                 zoomButton.classList.remove('zoomed');
                 zoomButton.title = "Aplicar Zoom";
             }
             applyZoom();
             saveSettings(); // Guardar estado del zoom
         }

         function applyZoom() {
             const zoomState = document.getElementById('zoom-button')?.dataset.state || localStorage.getItem('zoomState') || 'normal';
             const items = grid.querySelectorAll('.bookmark-item');

             if (zoomState === 'zoomed') {
                 grid.style.gridTemplateColumns = 'repeat(8, minmax(90px, 1fr))'; // M치s columnas, m치s peque침o
                 grid.style.gap = '10px';
                 items.forEach(item => {
                     item.classList.add('small-bookmark'); // Aplicar clase para estilos de zoom
                     const img = item.querySelector('img');
                     const nameSpan = item.querySelector('.bookmark-name');
                     if (img) img.style.width = '24px'; // Tama침o icono reducido
                     if (nameSpan) nameSpan.style.fontSize = '0.7rem'; // Tama침o texto reducido
                 });
             } else {
                 // Restaurar valores por defecto (o los responsivos si aplican)
                  const screenWidth = window.innerWidth;
                  if (screenWidth <= 480) {
                      grid.style.gridTemplateColumns = 'repeat(2, minmax(80px, 1fr))';
                      grid.style.gap = '8px';
                  } else if (screenWidth <= 768) {
                      grid.style.gridTemplateColumns = 'repeat(3, minmax(100px, 1fr))';
                      grid.style.gap = '10px';
                  } else {
                      grid.style.gridTemplateColumns = 'repeat(6, minmax(120px, 1fr))';
                      grid.style.gap = '15px';
                  }

                 items.forEach(item => {
                     item.classList.remove('small-bookmark');
                     const img = item.querySelector('img');
                     const nameSpan = item.querySelector('.bookmark-name');
                      // Restaurar tama침os basados en CSS por defecto o clamp()
                     if (img) img.style.width = ''; // Quitar estilo inline
                     if (nameSpan) nameSpan.style.fontSize = ''; // Quitar estilo inline
                 });
             }
         }

         function toggleFooter() {
             isFooterVisible = !isFooterVisible;
             const footerElement = document.querySelector('footer');
             if (isFooterVisible) {
                 footerElement.classList.remove('footer-hidden');
             } else {
                 footerElement.classList.add('footer-hidden');
             }
             saveSettings();
         }

        // --- Funciones de Avisos ---
         function showNextNotice() {
            if (!isActive) return; // No mostrar si est치n desactivados

            const noticeElement = document.getElementById('current-notice');
            const noticesContainer = document.querySelector('.notices-container');

             if (!noticeElement || !noticesContainer) return; // Salir si no existen

             // Asegurar que el contenedor sea visible si isActive es true
             noticesContainer.style.display = 'flex';

            noticeElement.style.animation = 'none'; // Reset animation
            void noticeElement.offsetWidth; // Trigger reflow

            currentNoticeIndex = (currentNoticeIndex + 1) % notices.length;
            noticeElement.textContent = notices[currentNoticeIndex];
            noticeElement.style.animation = 'fadeInOut 14s infinite';
        }

        function toggleNotices() {
            isActive = !isActive;
            const icon = document.getElementById('notice-toggle-icon');
            const noticesContainer = document.querySelector('.notices-container');
            const noticeWrapper = document.querySelector('.notice-wrapper'); // El span del texto
            const endIcon = document.querySelector('.megaphone-icon-end');

            if (isActive) {
                icon.src = "https://boardinggate.github.io/Tesla/IMG_4194.jpeg"; // Icono normal
                icon.title = "Desactivar Avisos";
                if (noticeWrapper) noticeWrapper.style.opacity = '1';
                if (endIcon) endIcon.style.opacity = '0.6';
                if (noticesContainer) noticesContainer.style.display = 'flex'; // Mostrar contenedor
                showNextNotice(); // Mostrar el primer aviso inmediatamente
                if (!noticeIntervalId) { // Iniciar intervalo solo si no existe
                     noticeIntervalId = setInterval(showNextNotice, 14000); // Cambia cada 14 segundos
                }
            } else {
                icon.src = "./IMG_4196_OFF.png"; // Icono OFF
                icon.title = "Activar Avisos";
                 if (noticeWrapper) noticeWrapper.style.opacity = '0'; // Ocultar texto
                 if (endIcon) endIcon.style.opacity = '0'; // Ocultar meg치fono
                 if (noticesContainer) noticesContainer.style.display = 'none'; // Ocultar todo el contenedor
                if (noticeIntervalId) {
                    clearInterval(noticeIntervalId); // Detener intervalo
                    noticeIntervalId = null;
                }
                // Opcional: Limpiar el texto del aviso actual
                // const noticeElement = document.getElementById('current-notice');
                // if (noticeElement) noticeElement.textContent = '';
            }
            saveSettings();
        }

         // --- Funciones de Recordatorios ---
        function getReminders() {
            return JSON.parse(localStorage.getItem('reminders') || '[]');
        }

        function saveReminders(reminders) {
            localStorage.setItem('reminders', JSON.stringify(reminders));
            updateReminderCount();
            scheduleReminderChecks(); // Re-programar comprobaciones
        }

         function openAddReminderModal() {
             // Abrir modal para a침adir NUEVO recordatorio
             document.getElementById('reminder-modal-title').textContent = "A침adir Recordatorio";
             document.getElementById('reminder-id').value = ''; // Limpiar ID
             document.getElementById('reminder-text').value = '';
             document.getElementById('reminder-time').value = '';
             document.getElementById('reminder-modal').style.display = 'block';
             document.getElementById('modal-overlay').style.display = 'block';
         }

         function openEditReminderModal(reminder) {
             document.getElementById('reminder-modal-title').textContent = "Modificar Recordatorio";
             document.getElementById('reminder-id').value = reminder.id;
             document.getElementById('reminder-text').value = reminder.text;
             document.getElementById('reminder-time').value = reminder.time;
             document.getElementById('reminder-modal').style.display = 'block';
             document.getElementById('modal-overlay').style.display = 'block';
         }

        function closeReminderModal() {
            document.getElementById('reminder-modal').style.display = 'none';
            document.getElementById('modal-overlay').style.display = 'none';
        }

        function handleReminderFormSubmit(event) {
            event.preventDefault();
            const id = document.getElementById('reminder-id').value;
            const text = document.getElementById('reminder-text').value.trim();
            const time = document.getElementById('reminder-time').value;

            if (!text || !time) return; // Validaci칩n b치sica

            let reminders = getReminders();
            if (id) { // Editando existente
                reminders = reminders.map(r => r.id === id ? { ...r, text, time } : r);
            } else { // A침adiendo nuevo
                const newReminder = { id: Date.now().toString(), text, time, notified: false };
                reminders.push(newReminder);
            }

            saveReminders(reminders);
            closeReminderModal();
        }

        function showReminderNotification(reminder) {
            const notificationsContainer = document.getElementById('reminder-notifications');
            if (!notificationsContainer) return;

            // Evitar duplicados si ya se est치 mostrando
            if (document.getElementById(`notif-${reminder.id}`)) return;

            const notification = document.createElement('div');
            notification.id = `notif-${reminder.id}`;
            notification.className = 'reminder-notification';
            notification.innerHTML = `
                <p>${reminder.text}</p>
                <div class="button-group">
                    <button class="postpone" data-id="${reminder.id}">Posponer 5m</button>
                    <button class="modify" data-id="${reminder.id}">Modificar</button>
                    <button class="cancel" data-id="${reminder.id}">OK</button>
                </div>
            `;

             // Aplicar estilo dark mode si es necesario
             if (document.body.classList.contains('dark-mode')) {
                 notification.classList.add('dark-mode-notification'); // O aplicar estilos directamente
                 notification.style.backgroundColor = '#6b7280';
                 notification.style.color = '#E5E7EB';
                 notification.querySelector('p').style.color = '#90EE90';
             }


            notification.querySelector('.cancel').addEventListener('click', () => dismissReminder(reminder.id));
            notification.querySelector('.modify').addEventListener('click', () => modifyReminder(reminder.id));
            notification.querySelector('.postpone').addEventListener('click', () => postponeReminder(reminder.id, 5)); // Posponer 5 minutos

            notificationsContainer.appendChild(notification);
            notificationsContainer.classList.remove('hidden'); // Asegurar que el contenedor es visible

             // Marcar como notificado para evitar que se repita inmediatamente
             let reminders = getReminders();
             reminders = reminders.map(r => r.id === reminder.id ? { ...r, notified: true } : r);
             saveReminders(reminders); // Guardar estado notificado
        }

         function dismissReminder(id) {
             const notification = document.getElementById(`notif-${id}`);
             if (notification) {
                 notification.remove();
             }
             // Opcional: Marcar como completado o eliminar permanentemente
             let reminders = getReminders();
             reminders = reminders.filter(r => r.id !== id); // Eliminar el recordatorio
             saveReminders(reminders);

             // Ocultar contenedor si no quedan notificaciones
             if (document.getElementById('reminder-notifications').children.length === 0) {
                 document.getElementById('reminder-notifications').classList.add('hidden');
             }
         }

         function modifyReminder(id) {
             const reminders = getReminders();
             const reminderToEdit = reminders.find(r => r.id === id);
             if (reminderToEdit) {
                 dismissReminder(id); // Cerrar notificaci칩n actual
                 openEditReminderModal(reminderToEdit);
             }
         }

         function postponeReminder(id, minutes) {
             let reminders = getReminders();
             const reminderIndex = reminders.findIndex(r => r.id === id);
             if (reminderIndex > -1) {
                 const now = new Date();
                 const [hours, mins] = reminders[reminderIndex].time.split(':');
                 let reminderTime = new Date();
                 reminderTime.setHours(parseInt(hours), parseInt(mins), 0, 0);

                 // Calcular nueva hora
                 reminderTime.setMinutes(reminderTime.getMinutes() + minutes);

                 const newHours = String(reminderTime.getHours()).padStart(2, '0');
                 const newMins = String(reminderTime.getMinutes()).padStart(2, '0');

                 reminders[reminderIndex].time = `${newHours}:${newMins}`;
                 reminders[reminderIndex].notified = false; // Resetear estado notificado

                 saveReminders(reminders);
                 dismissReminder(id); // Quitar la notificaci칩n actual
                 console.log(`Recordatorio ${id} pospuesto a las ${newHours}:${newMins}`);
             }
         }

        function checkReminders() {
            const now = new Date();
            const currentHours = now.getHours();
            const currentMinutes = now.getMinutes();
            const reminders = getReminders();

            reminders.forEach(reminder => {
                 if (reminder.notified) return; // Ya se notific칩 y no se ha pospuesto/modificado

                const [reminderHours, reminderMinutes] = reminder.time.split(':').map(Number);

                 // Comprobar si la hora del recordatorio ha llegado o pasado Y no se ha notificado a칰n
                 if (currentHours > reminderHours || (currentHours === reminderHours && currentMinutes >= reminderMinutes)) {
                    console.log(`Disparando notificaci칩n para: ${reminder.text} a las ${reminder.time}`);
                    showReminderNotification(reminder);
                    // El estado 'notified' se actualiza dentro de showReminderNotification
                 }
            });
        }

         function scheduleReminderChecks() {
             // Limpiar intervalo anterior si existe
             if (reminderCheckInterval) {
                 clearInterval(reminderCheckInterval);
             }
             // Iniciar comprobaci칩n cada minuto
             checkReminders(); // Comprobar inmediatamente al cargar/guardar
             reminderCheckInterval = setInterval(checkReminders, 60000); // Comprobar cada 60 segundos
         }

         function updateReminderCount() {
            const reminders = getReminders();
             // Contar solo los que NO han sido notificados O cuya hora a칰n no ha pasado
             const now = new Date();
             const currentTotalMinutes = now.getHours() * 60 + now.getMinutes();
             const activeCount = reminders.filter(r => {
                  const [rHours, rMins] = r.time.split(':').map(Number);
                  const reminderTotalMinutes = rHours * 60 + rMins;
                  // Es activo si la hora a칰n no ha pasado
                  return reminderTotalMinutes >= currentTotalMinutes;
             }).length;


            const countSpan = document.querySelector('#reminder-button .reminder-count');
            if (countSpan) {
                if (activeCount > 0) {
                    countSpan.textContent = activeCount;
                    countSpan.classList.remove('hidden');
                } else {
                    countSpan.classList.add('hidden');
                }
            }
         }

         function toggleReminderNotificationsVisibility() {
             const notificationsContainer = document.getElementById('reminder-notifications');
             if (notificationsContainer) {
                 // Solo alternar si hay notificaciones presentes
                 if (notificationsContainer.children.length > 0) {
                     notificationsContainer.classList.toggle('hidden');
                 } else {
                     // Si no hay notificaciones, asegurarse de que est칠 oculto
                     notificationsContainer.classList.add('hidden');
                 }
             }
         }


        // --- Funciones de Carga y Guardado ---
        function saveSettings() {
            localStorage.setItem('darkMode', JSON.stringify(isDarkMode));
            localStorage.setItem('minimalMode', JSON.stringify(isMinimalMode));
            // Guardar estado del zoom
             const zoomButton = document.getElementById('zoom-button');
            if (zoomButton) {
                localStorage.setItem('zoomState', zoomButton.dataset.state || 'normal');
            }
            // Guardar estado de los avisos
            localStorage.setItem('noticesActive', JSON.stringify(isActive));
            // Guardar visibilidad del footer
            localStorage.setItem('footerVisible', JSON.stringify(isFooterVisible));

            // No guardar rangos aqu칤, se guardan en toggleRangeVisibility
        }

        function loadSavedSettings() {
            // Modo Oscuro
            const savedDarkMode = localStorage.getItem('darkMode');
            isDarkMode = savedDarkMode ? JSON.parse(savedDarkMode) : checkDarkModeTime(); // Valor por defecto basado en la hora

            // Modo M칤nimo
            const savedMinimalMode = localStorage.getItem('minimalMode');
            isMinimalMode = savedMinimalMode ? JSON.parse(savedMinimalMode) : false;

            // Estado de Avisos
            const savedNoticesActive = localStorage.getItem('noticesActive');
            isActive = savedNoticesActive ? JSON.parse(savedNoticesActive) : true; // Activos por defecto

            // Visibilidad Footer
            const savedFooterVisible = localStorage.getItem('footerVisible');
            isFooterVisible = savedFooterVisible ? JSON.parse(savedFooterVisible) : true; // Visible por defecto
             const footerElement = document.querySelector('footer');
             if (!isFooterVisible && footerElement) {
                 footerElement.classList.add('footer-hidden');
             }

            // Aplicar estado inicial de avisos (antes de crear botones)
             const icon = document.getElementById('notice-toggle-icon');
             const noticesContainer = document.querySelector('.notices-container');
             const noticeWrapper = document.querySelector('.notice-wrapper');
             const endIcon = document.querySelector('.megaphone-icon-end');
            if (!isActive) {
                if(icon) icon.src = "./IMG_4196_OFF.png";
                if(icon) icon.title = "Activar Avisos";
                if(noticeWrapper) noticeWrapper.style.opacity = '0';
                if(endIcon) endIcon.style.opacity = '0';
                if(noticesContainer) noticesContainer.style.display = 'none'; // Ocultar contenedor al inicio si est치 inactivo
                 if (noticeIntervalId) clearInterval(noticeIntervalId);
                 noticeIntervalId = null;
            } else {
                 if(icon) icon.src = "https://boardinggate.github.io/Tesla/IMG_4194.jpeg";
                 if(icon) icon.title = "Desactivar Avisos";
                 if(noticesContainer) noticesContainer.style.display = 'flex'; // Mostrar contenedor
                 // El intervalo se inicia en init() despu칠s de crear elementos
            }

            // El estado del zoom se aplica en applyZoom(), que se llama despu칠s de crear la grid
            // Los rangos se aplican en applyRangeToggleVisibility() que se llama despu칠s de crear botones
        }

        // --- Inicializaci칩n ---
        function init() {
             document.getElementById('version').textContent = versionNumber; // Mostrar versi칩n
             loadSavedSettings(); // Cargar configuraciones ANTES de crear elementos
             populateGrid(); // Crear la cuadr칤cula de marcadores
             createControlButtons(); // Crear botones de control laterales
             applyDarkModeStyles(); // Aplicar modo oscuro si es necesario
             applyMinimalMode(); // Aplicar modo m칤nimo si es necesario
             applyZoom(); // Aplicar zoom si est치 guardado

             // Navegaci칩n hist칩rica con botones
             document.getElementById('back-button').addEventListener('click', () => window.history.back());
             document.getElementById('forward-button').addEventListener('click', () => window.history.forward());

             // Avisos
             document.getElementById('notice-toggle-icon').addEventListener('click', toggleNotices);
              if (isActive) {
                 showNextNotice(); // Mostrar el primer aviso
                 if (!noticeIntervalId) { // Iniciar intervalo solo si est치 activo y no existe ya
                     noticeIntervalId = setInterval(showNextNotice, 14000);
                 }
             }

             // Listener para cambios de tama침o de ventana (para reajustar zoom)
             window.addEventListener('resize', applyZoom);

             // Listeners para el modal de recordatorios
             document.getElementById('reminder-form').addEventListener('submit', handleReminderFormSubmit);
             document.getElementById('cancel-reminder').addEventListener('click', closeReminderModal);
             document.getElementById('modal-overlay').addEventListener('click', closeReminderModal); // Cerrar al hacer clic fuera

             scheduleReminderChecks(); // Iniciar la comprobaci칩n de recordatorios

             // Comprobaci칩n peri칩dica del contador de recordatorios activos (p.ej., cada 5 minutos)
             setInterval(updateReminderCount, 5 * 60 * 1000);
         }

        // Ejecutar inicializaci칩n cuando el DOM est칠 listo
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
